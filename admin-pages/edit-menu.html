<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="text"], input[type="number"], select {
            width: calc(100% - 10px);
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #218838;
        }
        #new-button {
            background-color: #007bff;
        }
        #new-button:hover {
            background-color: #0069d9;
        }
    </style>
    <script type="module">
        // Firebase initialization code
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD7ki0BzQn7YGkdr75Nk1PEc3G-qraWfF0",
            authDomain: "restrosync.firebaseapp.com",
            projectId: "restrosync",
            storageBucket: "restrosync.appspot.com",
            messagingSenderId: "1055612629411",
            appId: "1:1055612629411:web:1ec1b24087827f4c92aa16"
        };

        // Initialize Firebase and Firestore
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let rowCount = 1;

        document.addEventListener("DOMContentLoaded", function() {
            // Add new row for new menu items
            document.getElementById('new-button').addEventListener("click", function () {
                const tableBody = document.getElementById('menu-table-body');
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" id="dish-name-${rowCount}" placeholder="Enter a dish name..."></td>
                    <td><input type="number" id="quantities-${rowCount}" placeholder="Enter Quantities..."></td>
                    <td><input type="number" id="price-${rowCount}" placeholder="Enter Price in ₹"></td>
                    <td>
                        <select id="category-${rowCount}">
                            <option value="">Select a category</option>
                            <option value="starter">Starter</option>
                            <option value="main-course">Main Course</option>
                            <option value="dessert">Dessert</option>
                            <option value="beverage">Beverage</option>
                        </select>
                    </td>
                `;
                tableBody.appendChild(newRow);
                rowCount++;
            });

            // Save data to Firestore on save-button click
            document.getElementById('save-button').addEventListener("click", saveData);
        });

        // Function to delete all existing menu items
        async function clearMenu() {
            const querySnapshot = await getDocs(collection(db, 'menuItems'));
            const deletePromises = [];
            querySnapshot.forEach((doc) => {
                deletePromises.push(deleteDoc(doc.ref)); // Collect all delete promises
            });

            try {
                await Promise.all(deletePromises); // Wait for all delete promises to resolve
                console.log("All menu items deleted successfully.");
            } catch (error) {
                console.error("Error deleting documents: ", error);
            }
        }

        // Function to save the new menu items
        async function saveData() {
            await clearMenu(); // Clear existing menu items first

            const rows = document.querySelectorAll('#menu-table-body tr');
            for (const row of rows) {
                const dishName = row.querySelector('input[type="text"]').value;
                const quantities = row.querySelector('input[type="number"]').value;
                const price = row.querySelector('input[type="number"]').value; // Last number input is price
                const category = row.querySelector('select').value; // Get selected category

                if (dishName && quantities && price && category) {
                    try {
                        // Save each menu item as a new document in the menuItems collection
                        await addDoc(collection(db, 'menuItems'), {
                            dishName: dishName,
                            quantities: parseInt(quantities, 10),
                            price: parseFloat(price),
                            category: category // Save selected category
                        });
                        console.log("Document written with ID: ", dishName);
                    } catch (e) {
                        console.error("Error adding document: ", e);
                    }
                } else {
                    console.error("Some fields are missing!");
                }
            }
        }
    </script>
</head>
<body>
    <h1>Menu Editor</h1>
    <form action="">
        <table>
            <thead>
                <tr>
                    <th>Dish Name</th>
                    <th>Quantities</th>
                    <th>Price per Quantity</th>
                    <th>Category</th>
                </tr>
            </thead>
            <tbody id="menu-table-body">
                <tr>
                    <td><input type="text" id="dish-name-0" placeholder="Enter a dish name..."></td>
                    <td><input type="number" id="quantities-0" placeholder="Enter Quantities..."></td>
                    <td><input type="number" id="price-0" placeholder="Enter Price in ₹"></td>
                    <td>
                        <select id="category-0">
                            <option value="">Select a category</option>
                            <option value="starter">Starter</option>
                            <option value="main-course">Main Course</option>
                            <option value="dessert">Dessert</option>
                            <option value="beverage">Beverage</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
        <button type="button" id="new-button">Add Row +</button>
        <button type="button" id="save-button">Save Menu</button>
    </form>
</body>
</html>
